<!-- <!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OdwoÅ‚aj wizytÄ™</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <h2>OdwoÅ‚aj wizytÄ™</h2>

      <label for="pesel">Podaj PESEL:</label>
      <input
        type="text"
        id="pesel"
        name="pesel"
        required
        pattern="\d{11}"
        title="PESEL musi skÅ‚adaÄ‡ siÄ™ z 11 cyfr"
      />
      <button onclick="getAppointments()">PokaÅ¼ wizyty</button>

      <div id="appointments"></div>
    </div>

    <script>
      function getAppointments() {
        let pesel = document.getElementById("pesel").value;

        if (pesel.length !== 11 || isNaN(pesel)) {
          alert("âŒ PESEL musi skÅ‚adaÄ‡ siÄ™ z 11 cyfr!");
          return;
        }

        fetch("get_appo.php?pesel=" + pesel)
          .then((response) => response.json())
          .then((data) => {
            let appointmentsDiv = document.getElementById("appointments");
            appointmentsDiv.innerHTML = "";

            if (data.length === 0) {
              appointmentsDiv.innerHTML = "<p>Brak wizyt do odwoÅ‚ania.</p>";
              return;
            }

            data.forEach((appointment) => {
              let appointmentEl = document.createElement("div");
              appointmentEl.innerHTML = `
                            <p>ğŸ“… Data: ${appointment.data_wizyty} ğŸ•’ Godzina: ${appointment.godzina} ğŸ‘¨â€âš•ï¸ Lekarz: ${appointment.lekarz}</p>
                            <button onclick="cancelAppointment(${appointment.id_wizyty})">OdwoÅ‚aj</button>
                            <hr>
                        `;
              appointmentsDiv.appendChild(appointmentEl);
            });
          });
      }

      function cancelAppointment(id_wizyty) {
        if (!confirm("Czy na pewno chcesz odwoÅ‚aÄ‡ tÄ™ wizytÄ™?")) return;

        fetch("cancel_appo.php?id_wizyty=" + id_wizyty, {
          method: "GET",
        })
          .then((response) => response.json())
          .then((data) => {
            alert(data.message);
            getAppointments();
          });
      }
    </script>
  </body>
</html> -->

<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OdwoÅ‚aj wizytÄ™</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <h2>OdwoÅ‚aj wizytÄ™</h2>

      <label for="pesel">Podaj PESEL:</label>
      <input
        type="text"
        id="pesel"
        name="pesel"
        required
        pattern="\d{11}"
        title="PESEL musi skÅ‚adaÄ‡ siÄ™ z 11 cyfr"
      />
      <button onclick="getAppointments()">PokaÅ¼ wizyty</button>

      <div id="appointments"></div>
    </div>

    <script>
      function getAppointments() {
        let pesel = document.getElementById("pesel").value.trim();

        if (pesel.length !== 11 || isNaN(pesel)) {
          alert("âŒ PESEL musi skÅ‚adaÄ‡ siÄ™ z 11 cyfr!");
          return;
        }

        fetch("get_appointments.php?pesel=" + pesel)
          .then((response) => response.json())
          .then((data) => {
            let appointmentsDiv = document.getElementById("appointments");
            appointmentsDiv.innerHTML = "";

            if (!data || data.length === 0) {
              appointmentsDiv.innerHTML = "<p>Brak wizyt do odwoÅ‚ania.</p>";
              return;
            }

            data.forEach((appointment) => {
              let appointmentEl = document.createElement("div");
              appointmentEl.innerHTML = `
                            <p>ğŸ“… <b>Data:</b> ${appointment.data_wizyty}</p>
                            <p>ğŸ•’ <b>Godzina:</b> ${appointment.godzina}</p>
                            <p>ğŸ‘¨â€âš•ï¸ <b>Lekarz:</b> ${appointment.lekarz}</p>
                            <button onclick="cancelAppointment(${appointment.id_wizyty})">OdwoÅ‚aj</button>
                            <hr>
                        `;
              appointmentsDiv.appendChild(appointmentEl);
            });
          })
          .catch((error) => {
            console.error("BÅ‚Ä…d pobierania wizyt:", error);
            alert("âŒ WystÄ…piÅ‚ bÅ‚Ä…d przy pobieraniu wizyt.");
          });
      }

      function cancelAppointment(id_wizyty) {
        if (!confirm("Czy na pewno chcesz odwoÅ‚aÄ‡ tÄ™ wizytÄ™?")) return;

        fetch("cancel_appointment.php?id_wizyty=" + id_wizyty)
          .then((response) => response.json())
          .then((data) => {
            alert(data.message);
            getAppointments(); // OdÅ›wieÅ¼ listÄ™ wizyt po odwoÅ‚aniu
          })
          .catch((error) => {
            console.error("BÅ‚Ä…d przy odwoÅ‚ywaniu wizyty:", error);
            alert("âŒ Nie udaÅ‚o siÄ™ odwoÅ‚aÄ‡ wizyty.");
          });
      }
    </script>
  </body>
</html>
